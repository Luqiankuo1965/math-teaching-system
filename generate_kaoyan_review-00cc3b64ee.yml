name: è€ƒç ”æ•°å­¦å¤ä¹ å†…å®¹è‡ªåŠ¨ç”Ÿæˆç³»ç»Ÿ

on:
  workflow_dispatch:
    inputs:
      exam_type:
        description: 'è€ƒè¯•ç±»å‹'
        required: true
        type: choice
        options:
          - æ•°å­¦ä¸€
          - æ•°å­¦äºŒ
          - æ•°å­¦ä¸‰
        default: 'æ•°å­¦ä¸€'
      phase:
        description: 'å¤ä¹ é˜¶æ®µ'
        required: true
        type: choice
        options:
          - åŸºç¡€é˜¶æ®µ
          - å¼ºåŒ–é˜¶æ®µ
          - å†²åˆºé˜¶æ®µ
        default: 'åŸºç¡€é˜¶æ®µ'
      focus_area:
        description: 'é‡ç‚¹é¢†åŸŸ'
        required: true
        type: choice
        options:
          - é«˜é¢‘è€ƒç‚¹
          - æ˜“é”™ç‚¹
          - ç»¼åˆé¢˜
          - çœŸé¢˜è§£æ
          - æ¨¡æ‹Ÿè¯•å·
        default: 'é«˜é¢‘è€ƒç‚¹'
      difficulty:
        description: 'éš¾åº¦ç­‰çº§'
        required: true
        type: choice
        options:
          - åŸºç¡€
          - ä¸­ç­‰
          - å›°éš¾
          - çœŸé¢˜éš¾åº¦
        default: 'åŸºç¡€'
      include_progress_tracking:
        description: 'å¯ç”¨å­¦ä¹ è¿›åº¦è·Ÿè¸ª'
        required: true
        type: boolean
        default: true

env:
  PYTHON_VERSION: '3.11'

jobs:
  generate_kaoyan_content:
    runs-on: ubuntu-latest
    
    steps:
      - name: æ£€å‡ºä»£ç 
        uses: actions/checkout@v3
        with:
          fetch-depth: 0
      
      - name: è®¾ç½®Pythonç¯å¢ƒ
        uses: actions/setup-python@v4
        with:
          python-version: ${{ env.PYTHON_VERSION }}
      
      - name: åˆ›å»ºç›®å½•ç»“æ„
        run: |
          mkdir -p data/kaoyan
          mkdir -p data/kaoyan/${{ github.event.inputs.exam_type }}
          mkdir -p data/kaoyan/${{ github.event.inputs.exam_type }}/${{ github.event.inputs.phase }}
      
      - name: ç”Ÿæˆè€ƒç ”å¤ä¹ å†…å®¹
        run: python3 << 'PYTHON_SCRIPT'
import os
import json
from datetime import datetime

# è€ƒç ”æ•°å­¦é‡ç‚¹ç« èŠ‚é…ç½®
kaoyan_config = {
    "æ•°å­¦ä¸€": {
        "é«˜é¢‘è€ƒç‚¹": ["ç¬¬ä¸€ç« ", "ç¬¬äºŒç« ", "ç¬¬ä¸‰ç« ", "ç¬¬å››ç« ", "ç¬¬äº”ç« ", "ç¬¬å…­ç« ", "ç¬¬åç« ", "ç¬¬åä¸€ç« "],
        "æ˜“é”™ç‚¹": ["ç¬¬ä¸‰ç« ", "ç¬¬å››ç« ", "ç¬¬äº”ç« ", "ç¬¬å…­ç« ", "ç¬¬åç« "],
        "ç»¼åˆé¢˜": ["ç¬¬ä¸‰ç« +ç¬¬å››ç« ", "ç¬¬äº”ç« +ç¬¬å…­ç« ", "ç¬¬ä¸ƒç« +ç¬¬å…«ç« ", "ç¬¬åç« "]
    },
    "æ•°å­¦äºŒ": {
        "é«˜é¢‘è€ƒç‚¹": ["ç¬¬ä¸€ç« ", "ç¬¬äºŒç« ", "ç¬¬ä¸‰ç« ", "ç¬¬å››ç« ", "ç¬¬äº”ç« ", "ç¬¬å…­ç« "],
        "æ˜“é”™ç‚¹": ["ç¬¬ä¸‰ç« ", "ç¬¬å››ç« ", "ç¬¬äº”ç« ", "ç¬¬å…­ç« "],
        "ç»¼åˆé¢˜": ["ç¬¬ä¸‰ç« +ç¬¬å››ç« ", "ç¬¬äº”ç« +ç¬¬å…­ç« ", "ç¬¬äºŒç« +ç¬¬å››ç« "]
    },
    "æ•°å­¦ä¸‰": {
        "é«˜é¢‘è€ƒç‚¹": ["ç¬¬ä¸€ç« ", "ç¬¬äºŒç« ", "ç¬¬ä¸‰ç« ", "ç¬¬å››ç« ", "ç¬¬äº”ç« ", "ç¬¬å…­ç« ", "ç¬¬åç« ", "ç¬¬åä¸€ç« "],
        "æ˜“é”™ç‚¹": ["ç¬¬ä¸‰ç« ", "ç¬¬å››ç« ", "ç¬¬äº”ç« ", "ç¬¬å…­ç« ", "ç¬¬åä¸€ç« "],
        "ç»¼åˆé¢˜": ["ç¬¬ä¸‰ç« +ç¬¬å››ç« ", "ç¬¬äº”ç« +ç¬¬å…­ç« ", "ç¬¬åç« ", "ç¬¬åä¸€ç« "]
    }
}

# å†å¹´çœŸé¢˜åº“ï¼ˆç²¾é€‰ï¼‰
true_questions = {
    "ç¬¬ä¸€ç« ": [
        {
            "year": "2025",
            "type": "æ•°å­¦ä¸€",
            "score": 10,
            "question": "è®¾ $\\lim_{x\\to 0}\\frac{f(x)-1}{x} = 3$ï¼Œæ±‚ $\\lim_{x\\to 0}\\frac{f(x)-f(-x)}{2x}$",
            "solution": "6",
            "analysis": "åˆ©ç”¨æé™çš„çº¿æ€§æ€§è´¨ï¼Œ$\\lim_{x\\to 0}\\frac{f(x)-f(-x)}{2x} = \\frac{1}{2}[\\lim_{x\\to 0}\\frac{f(x)-1}{x} + \\lim_{x\\to 0}\\frac{1-f(-x)}{x}] = \\frac{1}{2}[3+3]=6$",
            "difficulty": "ä¸­ç­‰"
        },
        {
            "year": "2024",
            "type": "æ•°å­¦ä¸€",
            "score": 8,
            "question": "è®¡ç®— $\\lim_{x\\to 0}\\frac{e^x - 1 - x - \\frac{x^2}{2}}{x^3}$",
            "solution": "1/6",
            "analysis": "ä½¿ç”¨æ³°å‹’å±•å¼€æˆ–æ´›å¿…è¾¾æ³•åˆ™ï¼Œ$e^x = 1 + x + \\frac{x^2}{2} + \\frac{x^3}{6} + o(x^3)$ï¼Œåˆ†å­çº¦ä¸º $\\frac{x^3}{6}$",
            "difficulty": "å›°éš¾"
        }
    ],
    "ç¬¬ä¸‰ç« ": [
        {
            "year": "2025",
            "type": "æ•°å­¦ä¸€",
            "score": 12,
            "question": "è®¾ $f(x)$ åœ¨ $[0,1]$ ä¸Šè¿ç»­ï¼Œåœ¨ $(0,1)$ å†…å¯å¯¼ï¼Œä¸” $f(0)=0$ï¼Œ$f(1)=1$ï¼Œè¯æ˜å­˜åœ¨ $\\xi\\in(0,1)$ ä½¿å¾— $f'(\\xi)=2\\xi$",
            "solution": "æ„é€ è¾…åŠ©å‡½æ•° $F(x)=f(x)-x^2$ï¼Œåº”ç”¨ç½—å°”å®šç†",
            "analysis": "æ„é€ è¾…åŠ©å‡½æ•°æ˜¯ä¸­å€¼å®šç†è¯æ˜çš„å…³é”®ï¼Œ$F(0)=0$ï¼Œ$F(1)=0$ï¼Œç”±ç½—å°”å®šç†å­˜åœ¨ $\\xi\\in(0,1)$ ä½¿å¾— $F'(\\xi)=f'(\\xi)-2\\xi=0$",
            "difficulty": "å›°éš¾"
        },
        {
            "year": "2024",
            "type": "æ•°å­¦äºŒ",
            "score": 10,
            "question": "è¯æ˜ï¼šå½“ $x>0$ æ—¶ï¼Œ$e^x > 1 + x + \\frac{x^2}{2}$",
            "solution": "æ„é€  $f(x)=e^x-1-x-\\frac{x^2}{2}$ï¼Œæ±‚å¯¼è¯æ˜å•è°ƒé€’å¢",
            "analysis": "åˆ©ç”¨å¯¼æ•°è¯æ˜ä¸ç­‰å¼æ˜¯è€ƒç ”é«˜é¢‘è€ƒç‚¹ï¼Œ$f'(x)=e^x-1-x > 0$ï¼ˆå› ä¸º $e^x > 1+x$ï¼‰",
            "difficulty": "ä¸­ç­‰"
        }
    ],
    "ç¬¬å››ç« ": [
        {
            "year": "2025",
            "type": "æ•°å­¦ä¸€",
            "score": 11,
            "question": "è®¡ç®— $\\int \\frac{x\\arctan x}{(1+x^2)^2}dx$",
            "solution": "$\\frac{\\arctan x}{2(1+x^2)} + \\frac{x}{4(1+x^2)} + \\frac{1}{4}\\arctan x + C$",
            "analysis": "ä½¿ç”¨åˆ†éƒ¨ç§¯åˆ†æ³•ï¼Œ$u=\\arctan x$ï¼Œ$dv=\\frac{x}{(1+x^2)^2}dx$",
            "difficulty": "å›°éš¾"
        }
    ],
    "ç¬¬äº”ç« ": [
        {
            "year": "2025",
            "type": "æ•°å­¦ä¸€",
            "score": 10,
            "question": "è®¡ç®— $\\int_0^1 x|\\ln x|dx$",
            "solution": "$1/4$",
            "analysis": "å°†ç§¯åˆ†åŒºé—´åˆ†ä¸º $(0,1)$ï¼Œæ³¨æ„åˆ° $x\\in(0,1)$ æ—¶ $|\\ln x| = -\\ln x$ï¼Œä½¿ç”¨åˆ†éƒ¨ç§¯åˆ†æ³•",
            "difficulty": "ä¸­ç­‰"
        },
        {
            "year": "2024",
            "type": "æ•°å­¦äºŒ",
            "score": 12,
            "question": "æ±‚ç”±æ›²çº¿ $y=x^2$ å’Œ $y=\\sqrt{x}$ æ‰€å›´æˆçš„å›¾å½¢ç»• $x$ è½´æ—‹è½¬ä¸€å‘¨æ‰€å¾—æ—‹è½¬ä½“çš„ä½“ç§¯",
            "solution": "$\\frac{3\\pi}{10}$",
            "analysis": "æ—‹è½¬ä½“ä½“ç§¯å…¬å¼ $V=\\pi\\int_0^1[(\\sqrt{x})^2-(x^2)^2]dx = \\pi\\int_0^1(x-x^4)dx$",
            "difficulty": "ä¸­ç­‰"
        }
    ],
    "ç¬¬å…­ç« ": [
        {
            "year": "2025",
            "type": "æ•°å­¦ä¸€",
            "score": 10,
            "question": "æ±‚è§£å¾®åˆ†æ–¹ç¨‹ $y'' - 4y' + 4y = e^{2x}$",
            "solution": "$y = (C_1 + C_2x)e^{2x} + \\frac{x^2}{2}e^{2x}$",
            "analysis": "é½æ¬¡æ–¹ç¨‹é€šè§£ä¸º $(C_1 + C_2x)e^{2x}$ï¼Œè®¾ç‰¹è§£ä¸º $y^*=Ax^2e^{2x}$",
            "difficulty": "ä¸­ç­‰"
        }
    ]
}

# æ ¹æ®è¾“å…¥å‚æ•°ç¡®å®šç”Ÿæˆå†…å®¹
exam_type = "${{ github.event.inputs.exam_type }}"
phase = "${{ github.event.inputs.phase }}"
focus_area = "${{ github.event.inputs.focus_area }}"
difficulty = "${{ github.event.inputs.difficulty }}"
include_progress = "${{ github.event.inputs.include_progress_tracking }}" == "true"

# è·å–é‡ç‚¹ç« èŠ‚
if exam_type in kaoyan_config:
    if focus_area in ["é«˜é¢‘è€ƒç‚¹", "æ˜“é”™ç‚¹", "ç»¼åˆé¢˜"]:
        chapters = kaoyan_config[exam_type][focus_area]
    else:
        chapters = kaoyan_config[exam_type]["é«˜é¢‘è€ƒç‚¹"]
else:
    chapters = []

# å¤ä¹ é˜¶æ®µé…ç½®
phase_config = {
    "åŸºç¡€é˜¶æ®µ": {
        "title": "åŸºç¡€é˜¶æ®µå¤ä¹ ",
        "objectives": [
            "å…¨é¢è¦†ç›–é«˜ç­‰æ•°å­¦æ ¸å¿ƒçŸ¥è¯†ç‚¹",
            "æ‰“ç‰¢åŸºç¡€ï¼ŒæŒæ¡åŸºæœ¬æ¦‚å¿µå’Œæ–¹æ³•",
            "ç†Ÿç»ƒè®¡ç®—å¸¸è§é¢˜å‹",
            "å»ºç«‹å®Œæ•´çš„çŸ¥è¯†æ¡†æ¶"
        ],
        "suggestions": [
            "æ³¨é‡ç†è§£åŸºæœ¬æ¦‚å¿µï¼Œä¸è¦æ­»è®°ç¡¬èƒŒ",
            "å¤šåšåŸºç¡€é¢˜ï¼Œæé«˜è®¡ç®—å‡†ç¡®ç‡",
            "å»ºç«‹é”™é¢˜æœ¬ï¼ŒåŠæ—¶æ€»ç»“",
            "æ¯å¤©ä¿è¯2-3å°æ—¶å­¦ä¹ æ—¶é—´"
        ],
        "time_allocation": "æ¯å¤©2-3å°æ—¶ï¼Œæ¯å‘¨15-20å°æ—¶"
    },
    "å¼ºåŒ–é˜¶æ®µ": {
        "title": "å¼ºåŒ–é˜¶æ®µçªç ´",
        "objectives": [
            "çªç ´é«˜é¢‘è€ƒç‚¹å’Œéš¾ç‚¹",
            "æŒæ¡ç»¼åˆé¢˜è§£é¢˜æŠ€å·§",
            "è®­ç»ƒå¿«é€Ÿå‡†ç¡®è§£é¢˜èƒ½åŠ›",
            "æé«˜åšé¢˜é€Ÿåº¦å’Œæ­£ç¡®ç‡"
        ],
        "suggestions": [
            "é‡ç‚¹æ”»å…‹é«˜é¢‘è€ƒç‚¹å’Œæ˜“é”™ç‚¹",
            "å¤šåšç»¼åˆé¢˜ï¼Œæé«˜ç»¼åˆèƒ½åŠ›",
            "æ¨¡æ‹ŸçœŸå®è€ƒè¯•ç¯å¢ƒï¼Œé™æ—¶è®­ç»ƒ",
            "æ¯å¤©ä¿è¯3-4å°æ—¶å­¦ä¹ æ—¶é—´"
        ],
        "time_allocation": "æ¯å¤©3-4å°æ—¶ï¼Œæ¯å‘¨20-25å°æ—¶"
    },
    "å†²åˆºé˜¶æ®µ": {
        "title": "å†²åˆºé˜¶æ®µæ¨¡æ‹Ÿ",
        "objectives": [
            "å…¨çœŸæ¨¡æ‹Ÿè€ƒè¯•è®­ç»ƒ",
            "æŸ¥æ¼è¡¥ç¼ºï¼Œå·©å›ºè–„å¼±ç¯èŠ‚",
            "æŒæ¡æ—¶é—´åˆ†é…ç­–ç•¥",
            "è°ƒæ•´è€ƒè¯•å¿ƒæ€"
        ],
        "suggestions": [
            "è¿›è¡Œå…¨çœŸæ¨¡æ‹Ÿè€ƒè¯•ï¼Œä¸¥æ ¼é™æ—¶",
            "é‡ç‚¹å¤ä¹ é”™é¢˜å’Œè–„å¼±ç¯èŠ‚",
            "è°ƒæ•´ä½œæ¯ï¼Œä¿è¯è€ƒè¯•çŠ¶æ€",
            "æ¯å¤©ä¿è¯4-5å°æ—¶å­¦ä¹ æ—¶é—´"
        ],
        "time_allocation": "æ¯å¤©4-5å°æ—¶ï¼Œæ¯å‘¨30-35å°æ—¶"
    }
}

# ç”Ÿæˆç™½æ¿HTML
timestamp = datetime.now().strftime("%Y%m%d_%H%M%S")
filename = f"kaoyan_{exam_type}_{phase}_{focus_area}_{timestamp}.html"

html_content = f"""<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è€ƒç ”æ•°å­¦{exam_type}å¤ä¹ å†…å®¹ - {phase}</title>
    <style>
        * {{ margin: 0; padding: 0; box-sizing: border-box; }}
        body {{
            font-family: 'PingFang SC', 'Microsoft YaHei', sans-serif;
            background: #f5f7fa;
            padding: 20px;
            line-height: 1.8;
        }}
        .container {{
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }}
        .header {{
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px 40px;
        }}
        .header h1 {{
            font-size: 28px;
            margin-bottom: 10px;
        }}
        .header .meta {{
            font-size: 14px;
            opacity: 0.9;
        }}
        .content {{
            padding: 40px;
        }}
        .section {{
            margin-bottom: 40px;
            padding-bottom: 30px;
            border-bottom: 2px solid #f0f0f0;
        }}
        .section:last-child {{
            border-bottom: none;
        }}
        .section h2 {{
            font-size: 20px;
            color: #333;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }}
        .chapter-card {{
            background: #f8f9fa;
            padding: 25px;
            border-radius: 10px;
            margin-bottom: 20px;
            border-left: 4px solid #667eea;
        }}
        .chapter-card h3 {{
            font-size: 18px;
            color: #667eea;
            margin-bottom: 15px;
        }}
        .question {{
            background: #fff;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 15px;
            border: 1px solid #e0e0e0;
        }}
        .question h4 {{
            font-size: 15px;
            color: #333;
            margin-bottom: 10px;
            font-weight: 600;
        }}
        .true-question {{
            background: #fff8e1;
            border-left: 4px solid #ffa000;
        }}
        .difficulty-tag {{
            display: inline-block;
            padding: 3px 10px;
            border-radius: 15px;
            font-size: 12px;
            margin-left: 10px;
        }}
        .difficulty-tag.åŸºç¡€ {{
            background: #c8e6c9;
            color: #2e7d32;
        }}
        .difficulty-tag.ä¸­ç­‰ {{
            background: #fff9c4;
            color: #f57f17;
        }}
        .difficulty-tag.å›°éš¾ {{
            background: #ffcdd2;
            color: #c62828;
        }}
        .progress-section {{
            background: #f0f7ff;
            padding: 30px;
            border-radius: 10px;
            margin-top: 30px;
        }}
        .progress-section h3 {{
            font-size: 18px;
            color: #333;
            margin-bottom: 20px;
        }}
        .progress-bar-container {{
            margin-bottom: 20px;
        }}
        .progress-header {{
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            font-size: 14px;
        }}
        .progress-bar {{
            height: 10px;
            background: #e0e0e0;
            border-radius: 5px;
            overflow: hidden;
        }}
        .progress-fill {{
            height: 100%;
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
            border-radius: 5px;
            transition: width 0.5s;
        }}
        .chapter-progress-list {{
            margin-top: 20px;
        }}
        .chapter-progress-item {{
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            background: white;
            border-radius: 5px;
            margin-bottom: 10px;
        }}
        .checkbox {{
            margin-right: 10px;
            width: 20px;
            height: 20px;
        }}
        .progress-input {{
            width: 60px;
            padding: 5px;
            border: 1px solid #e0e0e0;
            border-radius: 5px;
            text-align: center;
        }}
        @media print {{
            body {{ background: white; padding: 0; }}
            .progress-section {{ display: none; }}
        }}
    </style>
    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ“š è€ƒç ”æ•°å­¦{exam_type}å¤ä¹ å†…å®¹</h1>
            <div class="meta">
                å¤ä¹ é˜¶æ®µï¼š{phase} | é‡ç‚¹é¢†åŸŸï¼š{focus_area} | éš¾åº¦ï¼š{difficulty} | ç”Ÿæˆæ—¶é—´ï¼š{datetime.now().strftime('%Y-%m-%d %H:%M:%S')}
            </div>
        </div>
        
        <div class="content">
            <!-- å¤ä¹ ç›®æ ‡ -->
            <div class="section">
                <h2>ğŸ¯ {phase_config[phase]['title']}</h2>
                <div style="color: #666; font-size: 15px;">
                    <p><strong>å¤ä¹ ç›®æ ‡ï¼š</strong></p>
                    <ul style="margin-left: 20px;">
"""

# æ·»åŠ å¤ä¹ ç›®æ ‡
for obj in phase_config[phase]['objectives']:
    html_content += f"                        <li>{obj}</li>\n"

html_content += f"""                    </ul>
                    <p style="margin-top: 20px;"><strong>å»ºè®®æ—¶é—´åˆ†é…ï¼š</strong>{phase_config[phase]['time_allocation']}</p>
                </div>
            </div>
            
            <!-- å¤ä¹ å»ºè®® -->
            <div class="section">
                <h2>ğŸ’¡ å¤ä¹ å»ºè®®</h2>
                <div style="color: #666; font-size: 15px; line-height: 2;">
"""

# æ·»åŠ å¤ä¹ å»ºè®®
for suggestion in phase_config[phase]['suggestions']:
    html_content += f"                    <p>â€¢ {suggestion}</p>\n"

html_content += """                </div>
            </div>
            
            <!-- é‡ç‚¹ç« èŠ‚ -->
            <div class="section">
                <h2>ğŸ“– é‡ç‚¹ç« èŠ‚</h2>
"""

# æ·»åŠ é‡ç‚¹ç« èŠ‚
for i, chapter in enumerate(chapters, 1):
    html_content += f"""
                <div class="chapter-card">
                    <h3>{i}. {chapter}</h3>
"""

    # æ·»åŠ çœŸé¢˜ï¼ˆå¦‚æœæœ‰ï¼‰
    if chapter in true_questions:
        html_content += f"""
                    <h4 style="font-size: 14px; color: #333; margin-bottom: 10px;">ğŸ”¥ å†å¹´çœŸé¢˜</h4>
"""
        for j, q in enumerate(true_questions[chapter], 1):
            html_content += f"""
                    <div class="question true-question">
                        <h4>
                            ã€çœŸé¢˜{j}ã€‘{q['year']}å¹´ {q['type']} - {q['score']}åˆ†
                            <span class="difficulty-tag {q['difficulty']}">{q['difficulty']}</span>
                        </h4>
                        <p style="margin-bottom: 10px;"><strong>é¢˜ç›®ï¼š</strong>{q['question']}</p>
                        <p style="margin-bottom: 10px; color: #666;"><strong>è§£ç­”è¦ç‚¹ï¼š</strong>{q['solution']}</p>
                        <details>
                            <summary style="cursor: pointer; color: #667eea;">æŸ¥çœ‹è¯¦ç»†è§£æ</summary>
                            <div style="margin-top: 15px; padding: 15px; background: #f8f9fa; border-radius: 5px;">
                                <p><strong>è¯¦ç»†è§£æï¼š</strong>{q['analysis']}</p>
                            </div>
                        </details>
                    </div>
"""
    
    html_content += """
                </div>
"""

# æ·»åŠ å­¦ä¹ è¿›åº¦è·Ÿè¸ª
if include_progress:
    html_content += f"""
            </div>
            
            <!-- å­¦ä¹ è¿›åº¦è·Ÿè¸ª -->
            <div class="progress-section">
                <h3>ğŸ“Š å­¦ä¹ è¿›åº¦è·Ÿè¸ª</h3>
                
                <div class="progress-bar-container">
                    <div class="progress-header">
                        <span>æ€»ä½“è¿›åº¦</span>
                        <span id="totalProgress">0%</span>
                    </div>
                    <div class="progress-bar">
                        <div id="progressBar" class="progress-fill" style="width: 0%;"></div>
                    </div>
                </div>
                
                <div class="chapter-progress-list">
"""

    # æ·»åŠ ç« èŠ‚è¿›åº¦åˆ—è¡¨
    for chapter in chapters:
        html_content += f"""
                    <div class="chapter-progress-item">
                        <label>
                            <input type="checkbox" class="checkbox" onchange="updateProgress()">
                            {chapter}
                        </label>
                        <div>
                            <span>å¾—åˆ†ï¼š</span>
                            <input type="number" class="progress-input" min="0" max="100" placeholder="0" onchange="updateProgress()">
                        </div>
                    </div>
"""

    html_content += f"""
                </div>
                
                <div style="margin-top: 20px; text-align: center;">
                    <button onclick="resetProgress()" style="padding: 10px 30px; border: none; border-radius: 8px; background: #667eea; color: white; font-size: 14px; cursor: pointer; margin-right: 10px;">é‡ç½®è¿›åº¦</button>
                    <button onclick="exportProgress()" style="padding: 10px 30px; border: none; border-radius: 8px; background: #e0e0e0; color: #666; font-size: 14px; cursor: pointer;">å¯¼å‡ºè¿›åº¦</button>
                </div>
            </div>
            
            <script>
                // åŠ è½½ä¿å­˜çš„è¿›åº¦
                function loadProgress() {{
                    const savedData = localStorage.getItem('kaoyan_progress_{exam_type}_{phase}_{timestamp}');
                    if (savedData) {{
                        const data = JSON.parse(savedData);
                        document.querySelectorAll('.checkbox').forEach((cb, index) => {{
                            if (data.completed[index]) {{
                                cb.checked = true;
                            }}
                        }});
                        document.querySelectorAll('.progress-input').forEach((input, index) => {{
                            if (data.scores[index]) {{
                                input.value = data.scores[index];
                            }}
                        }});
                        updateProgress();
                    }}
                }}
                
                // æ›´æ–°è¿›åº¦
                function updateProgress() {{
                    const checkboxes = document.querySelectorAll('.checkbox');
                    const inputs = document.querySelectorAll('.progress-input');
                    
                    const completed = [];
                    const scores = [];
                    
                    checkboxes.forEach(cb => {{
                        completed.push(cb.checked);
                    }});
                    
                    inputs.forEach(input => {{
                        scores.push(parseInt(input.value) || 0);
                    }});
                    
                    const totalChapters = checkboxes.length;
                    const completedCount = completed.filter(c => c).length;
                    const avgScore = scores.length > 0 ? scores.reduce((a, b) => a + b, 0) / scores.length : 0;
                    
                    const progress = Math.round((completedCount / totalChapters) * 100);
                    
                    document.getElementById('totalProgress').textContent = progress + '%';
                    document.getElementById('progressBar').style.width = progress + '%';
                    
                    // ä¿å­˜è¿›åº¦
                    const progressData = {{
                        completed: completed,
                        scores: scores,
                        progress: progress,
                        avgScore: Math.round(avgScore),
                        timestamp: new Date().toISOString()
                    }};
                    
                    localStorage.setItem('kaoyan_progress_{exam_type}_{phase}_{timestamp}', JSON.stringify(progressData));
                }}
                
                // é‡ç½®è¿›åº¦
                function resetProgress() {{
                    if (confirm('ç¡®å®šè¦é‡ç½®æ‰€æœ‰å­¦ä¹ è¿›åº¦å—ï¼Ÿ')) {{
                        document.querySelectorAll('.checkbox').forEach(cb => cb.checked = false);
                        document.querySelectorAll('.progress-input').forEach(input => input.value = '');
                        localStorage.removeItem('kaoyan_progress_{exam_type}_{phase}_{timestamp}');
                        updateProgress();
                    }}
                }}
                
                // å¯¼å‡ºè¿›åº¦
                function exportProgress() {{
                    const savedData = localStorage.getItem('kaoyan_progress_{exam_type}_{phase}_{timestamp}');
                    if (savedData) {{
                        const data = JSON.parse(savedData);
                        const content = `è€ƒç ”æ•°å­¦{exam_type}å­¦ä¹ è¿›åº¦æŠ¥å‘Š\\n`;
                        const content2 = `å¤ä¹ é˜¶æ®µï¼š{phase}\\n`;
                        const content3 = `å¯¼å‡ºæ—¶é—´ï¼š${{new Date().toLocaleString()}}\\n\\n`;
                        const content4 = `æ€»ä½“è¿›åº¦ï¼š${{data.progress}}%\\n`;
                        const content5 = `å¹³å‡å¾—åˆ†ï¼š${{data.avgScore}}åˆ†\\n\\n`;
                        const content6 = `ç« èŠ‚å®Œæˆæƒ…å†µï¼š\\n`;
                        
                        const chapters = {json.dumps([ch for ch in chapters], ensure_ascii=False)};
                        let chapterList = '';
                        chapters.forEach((ch, index) => {{
                            chapterList += `${{index + 1}}. ${{ch}}: ${{data.completed[index] ? 'âœ“' : 'âœ—'}} (${{data.scores[index] || 0}}åˆ†)\\n`;
                        }});
                        
                        const fullContent = content + content2 + content3 + content4 + content5 + content6 + chapterList;
                        
                        const blob = new Blob([fullContent], {{type: 'text/plain'}});
                        const url = URL.createObjectURL(blob);
                        const a = document.createElement('a');
                        a.href = url;
                        a.download = 'è€ƒç ”æ•°å­¦{exam_type}_å­¦ä¹ è¿›åº¦_{timestamp}.txt';
                        a.click();
                        URL.revokeObjectURL(url);
                    }}
                }}
                
                // é¡µé¢åŠ è½½æ—¶æ¢å¤è¿›åº¦
                window.onload = function() {{
                    loadProgress();
                }};
            </script>
"""

html_content += """
        </div>
    </div>
</body>
</html>
"""

# ä¿å­˜æ–‡ä»¶
save_path = f"data/kaoyan/{exam_type}/{phase}/{filename}"
os.makedirs(os.path.dirname(save_path), exist_ok=True)
with open(save_path, 'w', encoding='utf-8') as f:
    f.write(html_content)

print(f"è€ƒç ”å¤ä¹ å†…å®¹å·²ç”Ÿæˆï¼š{save_path}")

# ç”Ÿæˆå…ƒæ•°æ®
metadata = {
    "exam_type": exam_type,
    "phase": phase,
    "focus_area": focus_area,
    "difficulty": difficulty,
    "chapters": chapters,
    "filename": filename,
    "timestamp": datetime.now().isoformat(),
    "path": save_path,
    "features": {
        "progress_tracking": include_progress
    }
}

metadata_path = f"data/kaoyan/{exam_type}/{phase}/metadata_{timestamp}.json"
with open(metadata_path, 'w', encoding='utf-8') as f:
    json.dump(metadata, f, ensure_ascii=False, indent=2)

print(f"å…ƒæ•°æ®å·²ç”Ÿæˆï¼š{metadata_path}")
PYTHON_SCRIPT
      
      - name: æäº¤è€ƒç ”å¤ä¹ å†…å®¹
        run: |
          git config --local user.email "action@github.com"
          git config --local user.name "GitHub Action"
          git add data/kaoyan/
          git commit -m "ç”Ÿæˆè€ƒç ”æ•°å­¦å¤ä¹ å†…å®¹ï¼š${{ github.event.inputs.exam_type }} - ${{ github.event.inputs.phase }}"
          git push
      
      - name: ç”Ÿæˆå·¥ä½œæµæ€»ç»“
        run: |
          echo "ğŸ“ è€ƒç ”æ•°å­¦å¤ä¹ å†…å®¹ç”Ÿæˆå®Œæˆï¼" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "**ç”Ÿæˆå‚æ•°ï¼š**" >> $GITHUB_STEP_SUMMARY
          echo "- è€ƒè¯•ç±»å‹ï¼š${{ github.event.inputs.exam_type }}" >> $GITHUB_STEP_SUMMARY
          echo "- å¤ä¹ é˜¶æ®µï¼š${{ github.event.inputs.phase }}" >> $GITHUB_STEP_SUMMARY
          echo "- é‡ç‚¹é¢†åŸŸï¼š${{ github.event.inputs.focus_area }}" >> $GITHUB_STEP_SUMMARY
          echo "- éš¾åº¦ç­‰çº§ï¼š${{ github.event.inputs.difficulty }}" >> $GITHUB_STEP_SUMMARY
          echo "- å­¦ä¹ è¿›åº¦è·Ÿè¸ªï¼š${{ github.event.inputs.include_progress_tracking }}" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "**é‡ç‚¹ç« èŠ‚ï¼š**" >> $GITHUB_STEP_SUMMARY
          python3 << 'PYTHON_SCRIPT'
kaoyan_config = {
    "æ•°å­¦ä¸€": {"é«˜é¢‘è€ƒç‚¹": ["ç¬¬ä¸€ç« ", "ç¬¬äºŒç« ", "ç¬¬ä¸‰ç« ", "ç¬¬å››ç« ", "ç¬¬äº”ç« ", "ç¬¬å…­ç« ", "ç¬¬åç« ", "ç¬¬åä¸€ç« "]},
    "æ•°å­¦äºŒ": {"é«˜é¢‘è€ƒç‚¹": ["ç¬¬ä¸€ç« ", "ç¬¬äºŒç« ", "ç¬¬ä¸‰ç« ", "ç¬¬å››ç« ", "ç¬¬äº”ç« ", "ç¬¬å…­ç« "]},
    "æ•°å­¦ä¸‰": {"é«˜é¢‘è€ƒç‚¹": ["ç¬¬ä¸€ç« ", "ç¬¬äºŒç« ", "ç¬¬ä¸‰ç« ", "ç¬¬å››ç« ", "ç¬¬äº”ç« ", "ç¬¬å…­ç« ", "ç¬¬åç« ", "ç¬¬åä¸€ç« "]}
}
exam_type = "${{ github.event.inputs.exam_type }}"
focus_area = "${{ github.event.inputs.focus_area }}"
if focus_area in ["é«˜é¢‘è€ƒç‚¹", "æ˜“é”™ç‚¹", "ç»¼åˆé¢˜"]:
    chapters = kaoyan_config[exam_type][focus_area]
else:
    chapters = kaoyan_config[exam_type]["é«˜é¢‘è€ƒç‚¹"]
for i, ch in enumerate(chapters, 1):
    print(f"{i}. {ch}") >> $GITHUB_STEP_SUMMARY
PYTHON_SCRIPT
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "ğŸ“Š å¤ä¹ å†…å®¹å·²ä¿å­˜åˆ° \`data/kaoyan/\` ç›®å½•" >> $GITHUB_STEP_SUMMARY
          echo "ğŸ’¾ å­¦ä¹ è¿›åº¦ä¼šè‡ªåŠ¨ä¿å­˜åˆ°æµè§ˆå™¨æœ¬åœ°å­˜å‚¨" >> $GITHUB_STEP_SUMMARY
          echo "ğŸ“¥ å¯å¯¼å‡ºå­¦ä¹ è¿›åº¦æŠ¥å‘Š" >> $GITHUB_STEP_SUMMARY
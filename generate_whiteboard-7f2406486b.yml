name: ç”Ÿæˆè¯¾å ‚ç™½æ¿å†…å®¹

on:
  # æ¯æ¬¡å‘å¸ƒæ–°ç« èŠ‚æ—¶è§¦å‘
  release:
    types: [published]
  
  # æ‰‹åŠ¨è§¦å‘
  workflow_dispatch:
    inputs:
      chapter:
        description: 'ç« èŠ‚åç§°'
        required: true
        type: string
        default: 'ç¬¬ä¸€ç«  å‡½æ•°ä¸æé™'
      topic:
        description: 'çŸ¥è¯†ä¸»é¢˜'
        required: true
        type: string
        default: 'å‡½æ•°çš„æé™å®šä¹‰'
      difficulty:
        description: 'éš¾åº¦ç­‰çº§ (1-5)'
        required: true
        type: number
        default: 3

permissions:
  contents: write
  issues: read

jobs:
  generate:
    runs-on: ubuntu-latest
    
    steps:
      - name: æ£€å‡ºä»£ç 
        uses: actions/checkout@v4
      
      - name: è®¾ç½®Pythonç¯å¢ƒ
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'
      
      - name: å®‰è£…ä¾èµ–
        run: |
          pip install requests openai python-dotenv
      
      - name: åˆ›å»ºæ•°æ®ç›®å½•
        run: mkdir -p data/whiteboard
      
      - name: ç”Ÿæˆç™½æ¿å†…å®¹
        env:
          CHAPTER: ${{ github.event.inputs.chapter || 'ç¬¬ä¸€ç«  å‡½æ•°ä¸æé™' }}
          TOPIC: ${{ github.event.inputs.topic || 'å‡½æ•°çš„æé™å®šä¹‰' }}
          DIFFICULTY: ${{ github.event.inputs.difficulty || 3 }}
          # å¦‚æœä½¿ç”¨OpenAI APIï¼Œè¯·æ·»åŠ å¯¹åº”çš„Secret
          # OPENAI_API_KEY: ${{ secrets.OPENAI_API_KEY }}
        run: |
          python << 'EOF'
          import json
          import os
          from datetime import datetime
          
          # è·å–è¾“å…¥å‚æ•°
          chapter = os.environ.get('CHAPTER', 'ç¬¬ä¸€ç«  å‡½æ•°ä¸æé™')
          topic = os.environ.get('TOPIC', 'å‡½æ•°çš„æé™å®šä¹‰')
          difficulty = int(os.environ.get('DIFFICULTY', 3))
          
          print(f"ğŸ“ å¼€å§‹ç”Ÿæˆç™½æ¿å†…å®¹...")
          print(f"   ç« èŠ‚: {chapter}")
          print(f"   ä¸»é¢˜: {topic}")
          print(f"   éš¾åº¦: {difficulty}")
          
          # æ•°å­¦çŸ¥è¯†æ¨¡æ¿åº“
          math_templates = {
              'ç¬¬ä¸€ç«  å‡½æ•°ä¸æé™': {
                  'å‡½æ•°çš„æé™å®šä¹‰': {
                      'title': 'å‡½æ•°æé™çš„å®šä¹‰',
                      'sections': [
                          {
                              'type': 'concept',
                              'title': 'æ ¸å¿ƒæ¦‚å¿µ',
                              'content': [
                                  'è®¾å‡½æ•° $f(x)$ åœ¨ç‚¹ $x_0$ çš„æŸä¸ªå»å¿ƒé‚»åŸŸå†…æœ‰å®šä¹‰',
                                  'å¦‚æœå­˜åœ¨å¸¸æ•° $A$ï¼Œä½¿å¾—å¯¹äºä»»æ„ç»™å®šçš„æ­£æ•° $\\varepsilon$',
                                  'æ€»å­˜åœ¨æ­£æ•° $\\delta$ï¼Œä½¿å¾—å½“ $0 < |x - x_0| < \\delta$ æ—¶',
                                  'æ’æœ‰ $|f(x) - A| < \\varepsilon$'
                              ]
                          },
                          {
                              'type': 'formula',
                              'title': 'æé™çš„æ•°å­¦è¡¨è¾¾',
                              'content': [
                                  r'$$\lim_{x \to x_0} f(x) = A$$',
                                  r'$$\forall \varepsilon > 0, \exists \delta > 0, \text{ s.t. } 0 < |x - x_0| < \delta \Rightarrow |f(x) - A| < \varepsilon$$'
                              ]
                          },
                          {
                              'type': 'example',
                              'title': 'å…¸å‹ä¾‹é¢˜',
                              'content': [
                                  {
                                      'question': r'è¯æ˜ï¼š$\lim_{x \to 1} (2x + 1) = 3$',
                                      'solution': r'å¯¹äºä»»æ„ $\\varepsilon > 0$ï¼Œå– $\\delta = \frac{\\varepsilon}{2}$',
                                      'steps': [
                                          r'å½“ $0 < |x - 1| < \\delta$ æ—¶',
                                          r'$|(2x + 1) - 3| = |2x - 2| = 2|x - 1| < 2 \\cdot \frac{\\varepsilon}{2} = \\varepsilon$',
                                          r'å› æ­¤ $\lim_{x \to 1} (2x + 1) = 3$ âœ“'
                                      ]
                                  }
                              ]
                          },
                          {
                              'type': 'exercise',
                              'title': 'è¯¾å ‚ç»ƒä¹ ',
                              'content': [
                                  {
                                      'question': r'è¯æ˜ï¼š$\lim_{x \to 2} (3x - 1) = 5$',
                                      'hint': r'æç¤ºï¼šå– $\\delta = \frac{\\varepsilon}{3}$',
                                      'difficulty': 2
                                  },
                                  {
                                      'question': r'è¯æ˜ï¼š$\lim_{x \to 0} x^2 = 0$',
                                      'hint': r'æç¤ºï¼šå– $\\delta = \sqrt{\\varepsilon}$',
                                      'difficulty': 3
                                  }
                              ]
                          }
                      ]
                  },
                  'æé™çš„è¿ç®—æ³•åˆ™': {
                      'title': 'æé™çš„å››åˆ™è¿ç®—æ³•åˆ™',
                      'sections': [
                          {
                              'type': 'formula',
                              'title': 'è¿ç®—æ³•åˆ™',
                              'content': [
                                  r'è®¾ $\lim_{x \to x_0} f(x) = A$ï¼Œ$\lim_{x \to x_0} g(x) = B$ï¼Œåˆ™',
                                  r'$$\lim_{x \to x_0} [f(x) \pm g(x)] = A \pm B$$',
                                  r'$$\lim_{x \to x_0} [f(x) \cdot g(x)] = A \cdot B$$',
                                  r'$$\lim_{x \to x_0} \frac{f(x)}{g(x)} = \frac{A}{B} \quad (B \neq 0)$$'
                              ]
                          },
                          {
                              'type': 'example',
                              'title': 'åº”ç”¨ä¸¾ä¾‹',
                              'content': [
                                  {
                                      'question': r'è®¡ç®—ï¼š$\lim_{x \to 2} \frac{x^2 - 4}{x - 2}$',
                                      'solution': r'æ–¹æ³•ï¼šçº¦åˆ†',
                                      'steps': [
                                          r'åŸå¼ = $\lim_{x \to 2} \frac{(x-2)(x+2)}{x-2}$',
                                          r'$= \lim_{x \to 2} (x+2)$',
                                          r'$= 2 + 2 = 4$'
                                      ]
                                  }
                              ]
                          }
                      ]
                  }
              },
              'ç¬¬äºŒç«  å¯¼æ•°ä¸å¾®åˆ†': {
                  'å¯¼æ•°çš„å®šä¹‰': {
                      'title': 'å¯¼æ•°çš„å®šä¹‰ä¸å‡ ä½•æ„ä¹‰',
                      'sections': [
                          {
                              'type': 'concept',
                              'title': 'å¯¼æ•°å®šä¹‰',
                              "content": [
                                  'è®¾å‡½æ•° $y = f(x)$ åœ¨ç‚¹ $x_0$ çš„æŸé‚»åŸŸå†…æœ‰å®šä¹‰',
                                  'å½“è‡ªå˜é‡ $x$ åœ¨ $x_0$ å¤„å–å¾—å¢é‡ $\\Delta x$ æ—¶',
                                  'å‡½æ•° $y$ ç›¸åº”åœ°å–å¾—å¢é‡ $\\Delta y = f(x_0 + \\Delta x) - f(x_0)$'
                              ]
                          },
                          {
                              'type': 'formula',
                              'title': 'å¯¼æ•°çš„æ•°å­¦è¡¨è¾¾',
                              'content': [
                                  r'$$f'(x_0) = \lim_{\\Delta x \to 0} \frac{\\Delta y}{\\Delta x} = \lim_{\\Delta x \to 0} \frac{f(x_0 + \\Delta x) - f(x_0)}{\\Delta x}$$',
                                  r'$$f'(x_0) = \lim_{x \to x_0} \frac{f(x) - f(x_0)}{x - x_0}$$'
                              ]
                          },
                          {
                              'type': 'geometry',
                              'title': 'å‡ ä½•æ„ä¹‰',
                              'content': [
                                  'å¯¼æ•° $f'(x_0)$ è¡¨ç¤ºæ›²çº¿ $y = f(x)$ åœ¨ç‚¹ $(x_0, f(x_0))$ å¤„çš„',
                                  'åˆ‡çº¿æ–œç‡ $k = f\'(x_0)$'
                              ]
                          },
                          {
                              'type': 'example',
                              'title': 'å…¸å‹ä¾‹é¢˜',
                              'content': [
                                  {
                                      'question': r'æ±‚ $f(x) = x^2$ åœ¨ $x = 1$ å¤„çš„å¯¼æ•°',
                                      'solution': r'ä½¿ç”¨å¯¼æ•°å®šä¹‰',
                                      'steps': [
                                          r'$f\'(1) = \lim_{x \to 1} \frac{x^2 - 1}{x - 1}$',
                                          r'$= \lim_{x \to 1} \frac{(x-1)(x+1)}{x-1}$',
                                          r'$= \lim_{x \to 1} (x+1) = 2$'
                                      ]
                                  }
                              ]
                          }
                      ]
                  },
                  'å¯¼æ•°çš„å››åˆ™è¿ç®—': {
                      'title': 'å¯¼æ•°çš„å››åˆ™è¿ç®—æ³•åˆ™',
                      'sections': [
                          {
                              'type': 'formula',
                              'title': 'è¿ç®—æ³•åˆ™',
                              'content': [
                                  r'$$(u \pm v)\' = u\' \pm v\'$$',
                                  r'$$(uv)\' = u\'v + uv\'$$',
                                  r'$$(\frac{u}{v})\' = \frac{u\'v - uv\'}{v^2} \quad (v \neq 0)$$'
                              ]
                          },
                          {
                              'type': 'example',
                              'title': 'åº”ç”¨ä¸¾ä¾‹',
                              'content': [
                                  {
                                      'question': r'æ±‚ $y = x^3 \cdot \sin x$ çš„å¯¼æ•°',
                                      'solution': r'ä½¿ç”¨ä¹˜æ³•æ³•åˆ™',
                                      'steps': [
                                          r'$y\' = (x^3)\' \cdot \sin x + x^3 \cdot (\sin x)\'$',
                                          r'$= 3x^2 \cdot \sin x + x^3 \cdot \cos x$',
                                          r'$= x^2(3\sin x + x\cos x)$'
                                      ]
                                  }
                              ]
                          }
                      ]
                  }
              },
              'ç¬¬ä¸‰ç«  ç§¯åˆ†': {
                  'ä¸å®šç§¯åˆ†çš„å®šä¹‰': {
                      'title': 'ä¸å®šç§¯åˆ†çš„æ¦‚å¿µä¸æ€§è´¨',
                      'sections': [
                          {
                              'type': 'concept',
                              'title': 'åŸå‡½æ•°ä¸ä¸å®šç§¯åˆ†',
                              'content': [
                                  'è®¾ $F(x)$ æ˜¯ $f(x)$ åœ¨åŒºé—´ $I$ ä¸Šçš„ä¸€ä¸ªåŸå‡½æ•°',
                                  'åˆ™ $f(x)$ åœ¨åŒºé—´ $I$ ä¸Šçš„æ‰€æœ‰åŸå‡½æ•°çš„é›†åˆ',
                                  'ç§°ä¸º $f(x)$ åœ¨åŒºé—´ $I$ ä¸Šçš„ä¸å®šç§¯åˆ†'
                              ]
                          },
                          {
                              'type': 'formula',
                              'title': 'ç§¯åˆ†å…¬å¼',
                              'content': [
                                  r'$$\int f(x) dx = F(x) + C$$',
                                  r'$$\int k dx = kx + C \quad (k \text{ä¸ºå¸¸æ•°})$$',
                                  r'$$\int x^n dx = \frac{x^{n+1}}{n+1} + C \quad (n \neq -1)$$'
                              ]
                          },
                          {
                              'type': 'example',
                              'title': 'è®¡ç®—ä¸¾ä¾‹',
                              'content': [
                                  {
                                      'question': r'è®¡ç®— $\int (2x^3 + 3x - 1) dx$',
                                      'solution': r'é€é¡¹ç§¯åˆ†',
                                      'steps': [
                                          r'åŸå¼ = $\int 2x^3 dx + \int 3x dx - \int 1 dx$',
                                          r'$= \frac{2x^{4}}{4} + \frac{3x^{2}}{2} - x + C$',
                                          r'$= \frac{x^4}{2} + \frac{3x^2}{2} - x + C$'
                                      ]
                                  }
                              ]
                          }
                      ]
                  }
              }
          }
          
          # æ ¹æ®ç« èŠ‚å’Œä¸»é¢˜è·å–æ¨¡æ¿
          whiteboard_data = {
              'whiteboard_id': datetime.now().strftime('%Y%m%d%H%M%S'),
              'chapter': chapter,
              'topic': topic,
              'created_at': datetime.now().isoformat(),
              'difficulty': difficulty,
              'metadata': {
                  'estimated_time': '45åˆ†é’Ÿ',
                  'prerequisites': ['é«˜ä¸­æ•°å­¦åŸºç¡€'],
                  'learning_objectives': [
                      'ç†è§£æ ¸å¿ƒæ¦‚å¿µ',
                      'æŒæ¡åŸºæœ¬å…¬å¼',
                      'èƒ½å¤Ÿè§£å†³å…¸å‹é—®é¢˜'
                  ]
              }
          }
          
          # æŸ¥æ‰¾åŒ¹é…çš„æ¨¡æ¿
          template_found = False
          if chapter in math_templates:
              if topic in math_templates[chapter]:
                  whiteboard_data['sections'] = math_templates[chapter][topic]['sections']
                  template_found = True
                  print(f"âœ… æ‰¾åˆ°æ¨¡æ¿: {chapter} - {topic}")
              else:
                  # ä½¿ç”¨ç« èŠ‚çš„ç¬¬ä¸€ä¸ªä¸»é¢˜ä½œä¸ºé»˜è®¤
                  first_topic = list(math_templates[chapter].keys())[0]
                  whiteboard_data['sections'] = math_templates[chapter][first_topic]['sections']
                  whiteboard_data['note'] = f"æœªæ‰¾åˆ°'{topic}'çš„æ¨¡æ¿ï¼Œä½¿ç”¨'{first_topic}'ä½œä¸ºæ›¿ä»£"
                  print(f"âš ï¸  æœªæ‰¾åˆ°'{topic}'ï¼Œä½¿ç”¨'{first_topic}'æ›¿ä»£")
          else:
              # ä½¿ç”¨ç¬¬ä¸€ç« çš„ç¬¬ä¸€ä¸ªä¸»é¢˜ä½œä¸ºé»˜è®¤
              whiteboard_data['sections'] = math_templates['ç¬¬ä¸€ç«  å‡½æ•°ä¸æé™']['å‡½æ•°çš„æé™å®šä¹‰']['sections']
              whiteboard_data['note'] = f"æœªæ‰¾åˆ°'{chapter}'çš„æ¨¡æ¿ï¼Œä½¿ç”¨é»˜è®¤å†…å®¹"
              print(f"âš ï¸  æœªæ‰¾åˆ°'{chapter}'ï¼Œä½¿ç”¨é»˜è®¤æ¨¡æ¿")
          
          # ç”Ÿæˆç™½æ¿å†…å®¹æ–‡ä»¶
          filename = f"whiteboard_{datetime.now().strftime('%Y%m%d')}.json"
          filepath = f"data/whiteboard/{filename}"
          
          with open(filepath, 'w', encoding='utf-8') as f:
              json.dump(whiteboard_data, f, ensure_ascii=False, indent=2)
          
          print(f"âœ… ç™½æ¿å†…å®¹ç”Ÿæˆå®Œæˆï¼")
          print(f"   æ–‡ä»¶: {filename}")
          print(f"   ç« èŠ‚: {whiteboard_data['sections'][0]['title']}")
          print(f"   å†…å®¹æ¿å—æ•°: {len(whiteboard_data['sections'])}")
          
          # ç”ŸæˆHTMLé¢„è§ˆ
          html_content = f"""<!DOCTYPE html>
  <html lang="zh-CN">
  <head>
      <meta charset="UTF-8">
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <title>{whiteboard_data['chapter']} - {whiteboard_data['topic']} | è¯¾å ‚ç™½æ¿</title>
      <script>
      MathJax = {{
        tex: {{
          inlineMath: [['$', '$'], ['\\\\(', '\\\\)']],
          displayMath: [['$$', '$$'], ['\\\\[', '\\\\]']],
          processEscapes: true
        }}
      }};
      </script>
      <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
      <style>
          * {{ margin: 0; padding: 0; box-sizing: border-box; }}
          body {{ 
              font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
              background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
              min-height: 100vh;
              padding: 20px;
          }}
          .container {{ max-width: 1200px; margin: 0 auto; }}
          
          .header {{
              background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
              color: white;
              padding: 40px;
              border-radius: 20px;
              margin-bottom: 30px;
              text-align: center;
              box-shadow: 0 10px 30px rgba(102, 126, 234, 0.3);
          }}
          
          .header h1 {{ font-size: 32px; margin-bottom: 10px; }}
          .header .subtitle {{ opacity: 0.9; font-size: 18px; }}
          .header .meta {{ 
              margin-top: 20px; 
              display: flex; 
              justify-content: center; 
              gap: 30px;
              font-size: 14px;
              opacity: 0.8;
          }}
          
          .section {{
              background: white;
              padding: 30px;
              border-radius: 15px;
              margin-bottom: 25px;
              box-shadow: 0 5px 20px rgba(0,0,0,0.1);
              border-left: 5px solid #667eea;
          }}
          
          .section-title {{
              font-size: 24px;
              font-weight: 600;
              color: #333;
              margin-bottom: 20px;
              display: flex;
              align-items: center;
              gap: 10px;
          }}
          
          .section-title .icon {{ font-size: 28px; }}
          
          .content-item {{
              margin-bottom: 15px;
              padding: 15px;
              background: #f8f9fa;
              border-radius: 10px;
              line-height: 1.8;
              color: #555;
          }}
          
          .formula-box {{
              background: linear-gradient(135deg, #e8f5e8 0%, #d4edda 100%);
              padding: 20px;
              border-radius: 12px;
              margin: 15px 0;
              border-left: 4px solid #28a745;
              text-align: center;
              font-size: 18px;
          }}
          
          .example-card {{
              background: #fff;
              border: 2px solid #667eea;
              border-radius: 12px;
              padding: 20px;
              margin: 15px 0;
          }}
          
          .example-title {{
              font-weight: 600;
              color: #667eea;
              margin-bottom: 15px;
              font-size: 16px;
          }}
          
          .step-list {{
              list-style: none;
              margin-top: 10px;
          }}
          
          .step-list li {{
              padding: 10px 15px;
              margin: 8px 0;
              background: #f0f4ff;
              border-radius: 8px;
              border-left: 3px solid #667eea;
          }}
          
          .exercise-box {{
              background: linear-gradient(135deg, #fff3cd 0%, #ffeaa7 100%);
              padding: 20px;
              border-radius: 12px;
              margin: 15px 0;
              border-left: 4px solid #ffc107;
          }}
          
          .difficulty-badge {{
              display: inline-block;
              padding: 5px 12px;
              border-radius: 15px;
              font-size: 12px;
              font-weight: 600;
              margin-top: 10px;
          }}
          
          .difficulty-1 {{ background: #d4edda; color: #155724; }}
          .difficulty-2 {{ background: #cce5ff; color: #004085; }}
          .difficulty-3 {{ background: #fff3cd; color: #856404; }}
          .difficulty-4 {{ background: #f8d7da; color: #721c24; }}
          .difficulty-5 {{ background: #f5c6cb; color: #721c24; }}
          
          .toolbar {{
              position: fixed;
              top: 20px;
              right: 20px;
              background: white;
              padding: 15px;
              border-radius: 12px;
              box-shadow: 0 5px 20px rgba(0,0,0,0.2);
          }}
          
          .toolbar button {{
              display: block;
              width: 100%;
              padding: 10px 20px;
              margin: 5px 0;
              border: none;
              border-radius: 8px;
              cursor: pointer;
              font-size: 14px;
              font-weight: 600;
              transition: all 0.3s;
          }}
          
          .btn-print {{ background: #667eea; color: white; }}
          .btn-pdf {{ background: #28a745; color: white; }}
          .btn-back {{ background: #6c757d; color: white; }}
          
          @media print {{
              .toolbar {{ display: none; }}
              .section {{ box-shadow: none; break-inside: avoid; }}
          }}
      </style>
  </head>
  <body>
      <div class="toolbar">
          <button class="btn-print" onclick="window.print()">ğŸ–¨ï¸ æ‰“å°</button>
          <button class="btn-pdf" onclick="alert('PDFå¯¼å‡ºåŠŸèƒ½å¼€å‘ä¸­...')">ğŸ“„ å¯¼å‡ºPDF</button>
          <button class="btn-back" onclick="history.back()">â† è¿”å›</button>
      </div>
      
      <div class="container">
          <div class="header">
              <h1>{whiteboard_data['chapter']}</h1>
              <div class="subtitle">{whiteboard_data['topic']}</div>
              <div class="meta">
                  <span>ğŸ“… {datetime.now().strftime('%Yå¹´%mæœˆ%dæ—¥')}</span>
                  <span>â±ï¸ é¢„è®¡æ—¶é•¿: {whiteboard_data['metadata']['estimated_time']}</span>
                  <span>ğŸ“Š éš¾åº¦: {'â­' * difficulty}</span>
              </div>
          </div>
          
          <div class="learning-objectives">
              <div class="section">
                  <div class="section-title">
                      <span class="icon">ğŸ¯</span> å­¦ä¹ ç›®æ ‡
                  </div>
                  <ul style="list-style: none; padding: 15px;">
  """
          
          for obj in whiteboard_data['metadata']['learning_objectives']:
              html_content += f'                      <li style="padding: 10px; margin: 5px 0; background: #e8f4f8; border-radius: 8px;">âœ“ {obj}</li>\n'
          
          html_content += """                  </ul>
              </div>
          </div>
          
  """
          
          # æ·»åŠ å„ä¸ªæ¿å—
          for section_data in whiteboard_data['sections']:
              section_type = section_data['type']
              section_title = section_data['title']
              section_content = section_data['content']
              
              icons = {
                  'concept': 'ğŸ’¡',
                  'formula': 'ğŸ“',
                  'example': 'âœï¸',
                  'geometry': 'ğŸ“',
                  'exercise': 'ğŸ¯'
              }
              
              icon = icons.get(section_type, 'ğŸ“š')
              
              html_content += f"""          <div class="section">
              <div class="section-title">
                  <span class="icon">{icon}</span> {section_title}
              </div>
  """
              
              if section_type == 'formula':
                  for item in section_content:
                      html_content += f'              <div class="formula-box">{item}</div>\n'
              
              elif section_type == 'example':
                  for example in section_content:
                      html_content += f"""              <div class="example-card">
                  <div class="example-title">â“ {example.get('question', '')}</div>
                  <div class="content-item">ğŸ’¡ {example.get('solution', '')}</div>
  """
                      if 'steps' in example:
                          html_content += '                  <ul class="step-list">\n'
                          for step in example['steps']:
                              html_content += f'                      <li>{step}</li>\n'
                          html_content += '                  </ul>\n'
                      
                      html_content += '              </div>\n'
              
              elif section_type == 'exercise':
                  for exercise in section_content:
                      diff = exercise.get('difficulty', 1)
                      html_content += f"""              <div class="exercise-box">
                  <div class="content-item">â“ {exercise.get('question', '')}</div>
                  <div class="content-item">ğŸ’¡ æç¤º: {exercise.get('hint', 'æš‚æ— æç¤º')}</div>
                  <span class="difficulty-badge difficulty-{diff}">éš¾åº¦: {diff}çº§</span>
              </div>
  """
              
              else:
                  for item in section_content:
                      html_content += f'              <div class="content-item">{item}</div>\n'
              
              html_content += '          </div>\n\n'
          
          html_content += """      </div>
      
      <script>
          // é¡µé¢åŠ è½½åæ¸²æŸ“LaTeX
          window.addEventListener('load', function() {
              if (typeof MathJax !== 'undefined') {
                  MathJax.typeset();
              }
          });
      </script>
  </body>
  </html>"""
          
          # ä¿å­˜HTMLæ–‡ä»¶
          html_filename = f"whiteboard_{datetime.now().strftime('%Y%m%d')}.html"
          html_filepath = f"data/whiteboard/{html_filename}"
          
          with open(html_filepath, 'w', encoding='utf-8') as f:
              f.write(html_content)
          
          print(f"âœ… HTMLé¢„è§ˆç”Ÿæˆå®Œæˆï¼")
          print(f"   æ–‡ä»¶: {html_filename}")
          
          # æ›´æ–°ç™½æ¿ç´¢å¼•
          index_file = 'data/whiteboard/index.json'
          try:
              with open(index_file, 'r', encoding='utf-8') as f:
                  index = json.load(f)
          except:
              index = {'whiteboards': []}
          
          index['whiteboards'].append({
              'id': whiteboard_data['whiteboard_id'],
              'chapter': chapter,
              'topic': topic,
              'created_at': whiteboard_data['created_at'],
              'json_file': filename,
              'html_file': html_filename,
              'difficulty': difficulty
          })
          
          # æŒ‰æ—¶é—´å€’åºæ’åº
          index['whiteboards'] = sorted(index['whiteboards'], 
                                        key=lambda x: x['created_at'], 
                                        reverse=True)
          
          with open(index_file, 'w', encoding='utf-8') as f:
              json.dump(index, f, ensure_ascii=False, indent=2)
          
          print(f"âœ… ç´¢å¼•æ–‡ä»¶å·²æ›´æ–°ï¼")
          EOF
      
      - name: æäº¤ç™½æ¿æ–‡ä»¶
        run: |
          git config --local user.email "action@github.com"
          git config --local user.name "GitHub Action"
          git add data/whiteboard/
          git diff --quiet && git diff --staged --quiet || git commit -m "ğŸ“ ç”Ÿæˆè¯¾å ‚ç™½æ¿å†…å®¹ [è‡ªåŠ¨è¿è¡Œ]"
          git push

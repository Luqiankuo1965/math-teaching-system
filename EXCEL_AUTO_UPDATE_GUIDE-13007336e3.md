# 📊 Excel表格自动更新配置指南

**更新时间**：2026年2月5日  
**功能**：学生反馈数据自动导出为Excel表格，支持定时更新和事件触发

---

## 🎯 功能概述

### 自动更新模式

| 触发方式 | 更新频率 | 适用场景 |
|---------|---------|---------|
| **定时触发** | 每天8点（北京时间） | 日常数据监控 |
| **事件触发** | 新反馈提交时立即更新 | 实时数据跟踪 |
| **手动触发** | 随时可按需导出 | 临时数据导出 |

### Excel工作表结构

生成的Excel文件包含4个工作表：

| 工作表名称 | 内容描述 | 主要用途 |
|-----------|---------|---------|
| **反馈明细** | 每条反馈的完整信息 | 详细查询和分析 |
| **课程统计** | 按课程汇总的统计数据 | 课程质量评估 |
| **学生统计** | 按学生汇总的参与数据 | 学生学习跟踪 |
| **每日趋势** | 每日反馈数量和难度趋势 | 时间趋势分析 |

---

## ⚙️ 一、快速部署（5分钟）

### 步骤1：确认文件存在

确保以下文件已存在：

```
✅ .github/workflows/auto_export_feedback_excel.yml
✅ export_feedback_excel.py（可选，仅用于本地测试）
```

### 步骤2：启用GitHub Actions权限

1. 进入你的GitHub仓库
2. 点击 **Settings** → **Actions** → **General**
3. 滚动到 **Workflow permissions**
4. 选择 **Read and write permissions**
5. 勾选 **Allow GitHub Actions to create and approve pull requests**
6. 点击 **Save**

### 步骤3：手动触发一次测试

1. 进入仓库的 **Actions** 页面
2. 选择 **自动导出反馈数据到Excel（增强版）** 工作流
3. 点击 **Run workflow**
4. 保持默认参数，点击绿色的 **Run workflow** 按钮
5. 等待工作流执行完成

### 步骤4：验证生成结果

工作流执行完成后，检查：

1. **Actions页面** - 查看工作流运行日志，确认无错误
2. **data/excel/** 目录 - 确认生成了Excel文件
3. Excel文件内容 - 打开检查4个工作表的数据是否正确

---

## 🔧 二、自定义配置

### 1. 修改定时更新时间

编辑 `.github/workflows/auto_export_feedback_excel.yml` 文件：

```yaml
# 找到以下部分
schedule:
  - cron: '0 0 * * *'  # 当前设置为每天UTC 0点（北京时间8点）
```

**常用cron表达式示例**：

| 表达式 | 说明 |
|--------|------|
| `0 0 * * *` | 每天0点（北京时间8点） |
| `0 */6 * * *` | 每6小时一次 |
| `0 0 * * 1` | 每周一0点 |
| `0 0 1 * *` | 每月1号0点 |

**注意事项**：
- cron表达式使用UTC时间，北京时间需要加8小时
- 格式：`分 时 日 月 周`

### 2. 修改历史版本保留天数

在工作流文件中找到：

```bash
# 当前设置：保留最近7天的Excel文件
find data/excel/ -name "*.xlsx" -type f -mtime +7 -delete
```

修改数字`7`为你想要保留的天数。

### 3. 自定义Excel列宽

编辑 `export_feedback_excel.py` 文件中的 `format_sheet` 函数：

```python
def format_sheet(writer, sheet_name, data):
    worksheet = writer.sheets[sheet_name]
    
    # 自定义列宽（示例）
    column_widths = {
        'A': 20,  # 修改为你想要的宽度
        'B': 15,
        # ... 更多列
    }
    
    for col, width in column_widths.items():
        worksheet.column_dimensions[col].width = width
```

---

## 📥 三、使用方法

### 方法1：自动获取（推荐）

系统会自动在以下情况下更新Excel：

1. **每天8点** - 定时自动更新
2. **有新反馈** - 学生提交反馈时立即更新
3. **反馈被编辑** - 反馈内容修改时立即更新

**获取最新Excel文件**：

1. 进入仓库的 **Actions** 页面
2. 查看最近一次成功的 **自动导出反馈数据到Excel（增强版）** 运行
3. 在工作流总结中找到下载路径：`data/excel/反馈数据报表_时间戳.xlsx`
4. 点击文件名直接下载

### 方法2：手动导出

1. 进入仓库的 **Actions** 页面
2. 选择 **自动导出反馈数据到Excel（增强版）** 工作流
3. 点击 **Run workflow**
4. 配置参数：
   - **日期范围**：选择7天、30天、90天、180天或全部
   - **包含已关闭的反馈**：勾选则包含已关闭的反馈
   - **生成数据摘要**：勾选则生成JSON格式的数据摘要
5. 点击 **Run workflow**
6. 等待执行完成（通常30秒-2分钟）
7. 在工作流总结中下载生成的Excel文件

---

## 📊 四、Excel数据使用指南

### 工作表1：反馈明细

**主要字段说明**：

| 字段名 | 说明 | 示例 |
|--------|------|------|
| 创建时间 | 反馈提交的时间 | 2026-02-05 08:00:00 |
| Issue编号 | GitHub Issue的编号 | #123 |
| 课程名称 | 反馈所属的课程 | 高等数学 |
| 章节 | 反馈的章节 | 第一章 |
| 学生姓名 | 提交反馈的学生姓名 | 张三 |
| 学号 | 学生学号 | 20230001 |
| 反馈类型 | 反馈的分类 | 课程反馈 |
| 难度评分 | 1-5分的难度评分 | 3 |
| 难度等级 | 文字描述的难度 | 困难 |
| 标题 | Issue的标题 | 这里的题目太难了 |
| 反馈内容 | 反馈的详细内容 | ... |
| 状态 | Issue的状态（open/closed） | open |
| GitHub链接 | Issue的原始链接 | https://... |

**使用场景**：
- 查看详细的反馈内容
- 按学生或课程筛选
- 导入其他分析工具

### 工作表2：课程统计

**主要字段说明**：

| 字段名 | 说明 | 示例 |
|--------|------|------|
| 课程名称 | 课程的完整名称 | 高等数学 |
| 反馈总数 | 该课程收到的反馈数量 | 150 |
| 参与学生数 | 提交反馈的学生数量 | 45 |
| 平均难度 | 该课程的平均难度评分 | 3.2 |
| 容易（1分） | 评分1分的数量 | 10 |
| 一般（2分） | 评分2分的数量 | 25 |
| 困难（3分） | 评分3分的数量 | 60 |
| 非常困难（4分） | 评分4分的数量 | 35 |
| 极难（5分） | 评分5分的数量 | 20 |

**使用场景**：
- 评估课程难度
- 发现问题课程
- 教学质量分析

### 工作表3：学生统计

**主要字段说明**：

| 字段名 | 说明 | 示例 |
|--------|------|------|
| 学生姓名 | 学生姓名 | 张三 |
| 学号 | 学生学号 | 20230001 |
| 反馈次数 | 该学生提交的反馈总数 | 8 |
| 平均难度 | 该学生反馈的平均难度 | 2.5 |

**使用场景**：
- 识别活跃学生
- 跟踪学生参与度
- 发现学习困难的学生

### 工作表4：每日趋势

**主要字段说明**：

| 字段名 | 说明 | 示例 |
|--------|------|------|
| 日期 | 统计日期 | 2026-02-05 |
| 反馈数量 | 当天的反馈总数 | 15 |
| 平均难度 | 当天反馈的平均难度 | 3.1 |

**使用场景**：
- 分析反馈趋势
- 发现异常波动
- 评估教学效果

---

## 🛠️ 五、高级功能

### 1. 自动生成数据摘要

系统会自动生成JSON格式的数据摘要，包含：

- 热门课程TOP5
- 活跃学生TOP5
- 关键统计指标

**查看摘要**：

1. 进入 `data/excel/` 目录
2. 查找 `摘要_时间戳.json` 文件
3. 下载并打开查看

### 2. 历史版本管理

系统会自动保留最近7天的Excel历史版本，方便追溯：

```
data/excel/
├── 反馈数据报表_20260205_080000.xlsx  ← 最新版本
├── 反馈数据报表_20260204_080000.xlsx  ← 昨天的版本
├── 反馈数据报表_20260203_080000.xlsx  ← 前天的版本
└── LATEST.txt                         ← 最新版本指针
```

### 3. 邮件通知（需配置）

如果需要邮件通知，可以在工作流中添加邮件发送步骤：

```yaml
- name: 发送邮件通知
  uses: dawidd6/action-send-mail@v3
  with:
    server_address: smtp.example.com
    server_port: 465
    username: ${{ secrets.EMAIL_USERNAME }}
    password: ${{ secrets.EMAIL_PASSWORD }}
    subject: Excel数据已更新
    to: your-email@example.com
    from: notification@example.com
    body: 最新的反馈数据Excel已生成，请查收！
```

---

## ❓ 六、常见问题

### Q1: Excel文件没有生成？

**可能原因**：
- 没有启用GitHub Actions权限
- 工作流执行失败
- 没有反馈数据

**解决方法**：
1. 检查Actions权限设置
2. 查看工作流运行日志
3. 确认仓库中有带"反馈"标签的Issue

### Q2: 如何修改Excel文件名？

编辑工作流文件中的以下行：

```python
excel_filename = f'反馈数据报表_{timestamp}.xlsx'
```

修改 `反馈数据报表` 为你想要的文件名。

### Q3: 如何添加自定义字段？

需要在两个地方修改：

1. **解析逻辑**（在Python脚本中）：
```python
# 添加新字段的解析
for line in body.split('\n'):
    if '你的新字段' in line:
        # 解析逻辑...
        your_field = parts[-1].strip()
```

2. **数据结构**（在Python脚本中）：
```python
record = {
    # ... 现有字段
    '你的新字段': your_field
}
```

### Q4: Excel文件太大怎么办？

**解决方法**：
1. 使用手动触发，选择较短的日期范围
2. 在工作流中限制导出的记录数量
3. 按时间分批导出

### Q5: 如何导出到其他格式（CSV、JSON）？

在Python脚本中添加：

```python
# 导出为CSV
df_feedback.to_csv('feedback.csv', index=False, encoding='utf-8-sig')

# 导出为JSON
df_feedback.to_json('feedback.json', orient='records', force_ascii=False)
```

---

## 📝 七、维护建议

### 定期检查

1. **每周** - 检查工作流是否正常运行
2. **每月** - 清理不再需要的旧版本文件
3. **每学期** - 根据教学需求调整数据结构和分析维度

### 性能优化

如果反馈数据量很大（>1000条），可以考虑：

1. 使用数据库存储数据，而不是每次从GitHub获取
2. 增加数据缓存机制
3. 优化GitHub API调用频率

### 数据备份

定期备份Excel文件到：

- 本地硬盘
- 云存储（如Google Drive、Dropbox）
- 其他版本控制系统

---

## 🎓 八、最佳实践

### 1. 数据管理

- 定期审查和清理无效反馈
- 使用标签分类不同类型的反馈
- 及时关闭已处理的反馈

### 2. 使用技巧

- 使用Excel的筛选功能快速定位问题
- 利用数据透视表进行深度分析
- 图表化展示趋势数据

### 3. 教学应用

- 每周查看课程统计，发现教学难点
- 关注学生统计，识别需要帮助的学生
- 分析每日趋势，评估教学效果

---

## 📞 九、技术支持

### 获取帮助

1. **查看日志**：GitHub Actions页面查看详细执行日志
2. **检查文档**：参考 `docs/COMPLETE_DELIVERY_GUIDE.md`
3. **提交Issue**：在仓库中提交问题反馈

### 故障排查流程

1. 检查工作流是否触发
2. 查看错误日志信息
3. 验证GitHub API权限
4. 测试手动触发功能
5. 检查数据格式是否正确

---

## 📚 十、相关文档

- [系统总览](docs/SYSTEM_OVERVIEW.md)
- [快速开始](docs/QUICK_START.md)
- [完整交付指南](docs/COMPLETE_DELIVERY_GUIDE.md)
- [考研数学自动生成](docs/KAOYAN_MATH_AUTO_GENERATION.md)

---

**配置完成时间**：2026年2月5日  
**文档版本**：v1.0  
**最后更新**：2026年2月5日
